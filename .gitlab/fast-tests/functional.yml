### Rules
# .rules-when-review                          ( works on pipelines: review A | nightly A | renovate A)
# .rules-when-review-manual-allow-failure     ( works on pipelines: review M | nightly A | renovate M)
# .rules-when-release                         ( works on pipelines: release A)


###################################### E2E Tests ######################################
.e2e-tests-parallel:
  extends:
    - .fast-tests
    - .parallel-e2e-tests
  image: ${IMAGE_JS_PAYMENTS_TESTS}

.e2e-tests-sequentially:
  extends:
    - .fast-tests
    - .sequentially-tests
  image: ${IMAGE_JS_PAYMENTS_TESTS}

# Card Payments E2E Tests Headless
e2e-card-payments-tests-review:
  extends:
    - .e2e-tests-parallel
    - .services-app-html-review
    - .rules-when-review
    - .tags-js-docker # @todo: STJS-2249 rollback to public runners
  variables:
    FEATURE_FILES_DIR: 'features/e2e_tests'
  parallel: 26

e2e-card-payments-tests-release:
  extends:
    - .e2e-tests-parallel
    - .service-app-html-release-merchant
    - .rules-when-release
    - .tags-js-docker # @todo: STJS-2249 rollback to public runners
  variables:
    FEATURE_FILES_DIR: 'features/e2e_tests'
  parallel: 26

# Cardinal Commerce E2E Tests Headless
e2e-cardinal-commerce-tests-review:
  extends:
    - .e2e-tests-parallel
    - .services-app-html-review
    - .rules-when-review
    - .tags-js-docker # @todo: STJS-2249 rollback to public runners
  variables:
    FEATURE_FILES_DIR: 'features/e2e_tests/e2e_cardinal_commerce'
  parallel: 9

e2e-cardinal-commerce-tests-release:
  extends:
    - .e2e-tests-parallel
    - .service-app-html-release-merchant
    - .rules-when-release
    - .tags-js-docker # @todo: STJS-2249 rollback to public runners
  variables:
    FEATURE_FILES_DIR: 'features/e2e_tests/e2e_cardinal_commerce'
  parallel: 9

# Should be uncommented when gateway on prod will be ready
## 3DS SDK (Trust provider) E2E Tests Headless
#e2e-3ds-sdk-tests-review:
#  extends:
#    - .e2e-tests-parallel
#    - .services-app-html-review
#    - .rules-when-review
#  variables:
#    FEATURE_FILES_DIR: 'features/e2e_tests/e2e_3ds_sdk'
#  parallel: 23
#
#e2e-3ds-sdk-tests-release:
#  extends:
#    - .e2e-tests-parallel
#    - .service-app-html-release-merchant
#    - .rules-when-release
#  variables:
#    FEATURE_FILES_DIR: 'features/e2e_tests/e2e_3ds_sdk'
#  parallel: 23
#
# APMs E2E Tests Headless
e2e-apms-tests-review:
  extends:
    - .e2e-tests-parallel
    - .services-app-html-review
    - .rules-when-review
    - .tags-js-docker # @todo: STJS-2249 rollback to public runners
  variables:
    FEATURE_FILES_DIR: 'features/e2e_tests/e2e_apm/ppro'
  parallel: 20

e2e-apms-tests-release:
  extends:
    - .e2e-tests-parallel
    - .service-app-html-release-merchant
    - .rules-when-release
    - .tags-js-docker # @todo: STJS-2249 rollback to public runners
  variables:
    FEATURE_FILES_DIR: 'features/e2e_tests/e2e_apm/ppro'
  parallel: 20

e2e-vc2p-tests-release:
  extends:
    - .e2e-tests-parallel
    - .service-app-html-release-merchant
    - .rules-when-release
    - .tags-js-docker
  variables:
    FEATURE_FILES_DIR: 'features/e2e_tests/e2e_visa_click_to_pay'
  parallel: 2

# Merchants features E2E Tests Headless
e2e-merchants-features-tests-nightly:
  extends:
    - .e2e-tests-parallel
    - .services-app-html-review
    - .rules-when-review-manual-allow-failure
  variables:
    IGNORED_FILES: 'e2e_acs_pop_up_close_trust.feature'
    FEATURE_FILES_DIR: 'features/e2e_tests/e2e_merchants_requests'
  parallel: 4

e2e-merchants-features-tests-release:
  extends:
    - .e2e-tests-parallel
    - .service-app-html-release-merchant
    - .rules-when-release
  variables:
    IGNORED_FILES: 'e2e_acs_pop_up_close_trust.feature'
    FEATURE_FILES_DIR: 'features/e2e_tests/e2e_merchants_requests'
  parallel: 4

# Smoke E2E Tests Headless -> exactly same scope which is used in extended tests as $SMOKE_E2E_TESTS_TAG
e2e-smoke-tests-review:
  extends:
    - .e2e-tests-parallel
    - .services-app-html-review
    - .rules-when-review
    - .tags-js-docker # @todo: STJS-2249 rollback to public runners
  variables:
    FEATURE_FILES_DIR: 'features/e2e_tests/e2e_smoke_tests'
  parallel: 4

.e2e-smoke-tests-release:
  extends:
    - .e2e-tests-parallel
    - .service-app-html-release-merchant
    - .rules-when-release
    - .tags-js-docker # @todo: STJS-2249 rollback to public runners
  variables:
    FEATURE_FILES_DIR: 'features/e2e_tests/e2e_smoke_tests'
  parallel: 4

# Additional coverage E2E Tests Headless
.e2e-additional-coverage-tests-nightly:
  extends:
    - .e2e-tests-parallel
    - .services-app-html-review
    - .rules-when-review-manual-allow-failure
  variables:
    FEATURE_FILES_DIR: 'features/e2e_tests/e2e_additional_coverage'
  parallel: 18

################################### Component Tests ###################################
.component-app-html-mock:
  extends:
    - .fast-tests
    - .services-app-html-mock
  image: ${IMAGE_JS_PAYMENTS_TESTS}

.card-payments-contract-tests:
  extends:
    - .component-app-html-mock
    - .parallel-component-tests
  variables:
    FEATURE_FILES_DIR: 'features/component_tests/contract_tests'
  parallel: 12

contract-card-payments-tests-review:
  extends:
    - .card-payments-contract-tests
    - .rules-when-review

contract-card-payments-tests-release:
  extends:
    - .card-payments-contract-tests
    - .rules-when-release

.visa-checkout-component-tests:
  extends:
    - .component-app-html-mock
    - .sequentially-component-tests
  variables:
    FEATURE_FILE_NAME: 'component_tests/digitalwallet_tests/visa_checkout.feature'

component-visa-checkout-tests-review:
  extends:
    - .visa-checkout-component-tests
    - .rules-when-review

component-visa-checkout-tests-release:
  extends:
    - .visa-checkout-component-tests
    - .rules-when-release

.google-pay-component-tests:
  extends:
    - .component-app-html-mock
    - .sequentially-component-tests
  variables:
    FEATURE_FILE_NAME: 'component_tests/digitalwallet_tests/google_pay.feature'

component-google-pay-tests-review:
  extends:
    - .google-pay-component-tests
    - .rules-when-review

component-google-pay-tests-release:
  extends:
    - .google-pay-component-tests
    - .rules-when-release
