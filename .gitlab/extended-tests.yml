### About resource_group
# Browserstack allow us to run 5 parallel jobs, so we need to limit executing browserstack jobs to max 5 in the same time
# Even if Browserstack jobs from fast-tests will be ran, then we still have Queue (5), so it should not be an issue.
# Resource groups - https://docs.gitlab.com/ee/ci/yaml/#resource_group
# We will have 4 resource groups for review and 4 for release: extended_tests_release_1 - ... - extended_tests_release_4, extended_tests_review_1 - ... - extended_tests_review_4
# It will assure that we won't use more than 5 parallel extended Browserstack tests jobs.
.extended-tests-sauce-labs:
  extends:
    - .extended-tests
  image: ${IMAGE_JS_PAYMENTS_TESTS}
  variables:
#    SL_USERNAME: ${SAUCE_LABS_USER}
    SL_USERNAME: 'pgs-test-1'
#    SL_ACCESS_KEY: ${SAUCE_LABS_API_KEY}
    SL_ACCESS_KEY: '9f602107-0df6-4500-ab45-6083e933cb79'
    BUILD_NAME: ${CI_COMMIT_REF_SLUG}/${CI_PIPELINE_ID}/${CI_JOB_NAME}
    REMOTE: "true"
    BEHAVE_LOGGING_LEVEL: INFO
    WORKDIR: "${IMAGE_PAYMENTS_TESTS_WORKDIR}"
    FEATURE_FILES_DIR: 'features'
  before_script:
    - wget --quiet https://saucelabs.com/downloads/sc-4.6.3-linux.tar.gz
    - tar -xf sc-4.6.3-linux.tar.gz
    - ./sc-4.6.3-linux/bin/sc -u "${SL_USERNAME}" -k "${SL_ACCESS_KEY}" & #-x https://eu-central-1.saucelabs.com/rest/v1 -i test_tunnel_for_web_tests&
    - sleep 60
    - . .cicd_scripts/execute/tests.sh
    - validate_and_activate_e2e_variables
  script:
    - echo "run script"
    - . .cicd_scripts/execute/tests.sh
    - execute_tests_sequentially_browserstack "${BEHAVE_LOGGING_LEVEL}" "${FEATURE_FILES_DIR}" "${POETRY_TAGS}"
    # - poetry run behave --logging-level="${BEHAVE_LOGGING_LEVEL}" --tags="${poetry_tags}" "${tests_dir}"
.extended-tests-browserstack:
  extends:
    - .extended-tests
    - .services-app-html-test
    - .extended-tests-sauce-labs
  #    - .sequentially-component-browserstack-tests
  image: ${IMAGE_JS_PAYMENTS_TESTS}

#.visual-regression-tests:
#  extends:
#    - .extended-tests
#    - .services-app-html-dev
#    - .extended-tests-sauce-labs
#  #    - .sequentially-e2e-browserstack-tests
#  image: ${IMAGE_JS_PAYMENTS_TESTS}

#
#       COMPONENT
#
# smoke tests executed on review branches
#.apple-test-browserstack-component-test:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-always
#  variables:
#    OS: "OS X"
#    OS_VERSION: 10.11
#    BROWSER: Safari
#    BROWSER_VERSION: '12.1'
#    BROWSERSTACK_SAFARI_DRIVER: '2.48'
#    BROWSERSTACK_SELENIUM_VERSION: '3.141.59'
#
#apple-test-part1-browserstack-component-test:
#  extends: .apple-test-browserstack-component-test
#  variables:
#    POETRY_TAGS: apple_test_part1
#  resource_group: extended_tests_review_1
#
#apple-test-part2-browserstack-component-test:
#  extends: .apple-test-browserstack-component-test
#  variables:
#    POETRY_TAGS: apple_test_part2
#  resource_group: extended_tests_review_2
#

#     SMOKE
#
## smoke tests executed on master branch
#win10-Chrome-latest-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-always
#  variables:
#    OS: Windows
#    OS_VERSION: 10
#    BROWSER: chrome
#    BROWSER_VERSION: 'latest'
#    POETRY_TAGS: $SMOKE_TESTS_TAG
#  resource_group: extended_tests_review_1
#
#win10-Firefox-latest-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-always
#  variables:
#    OS: Windows
#    OS_VERSION: 10
#    BROWSER: firefox
#    BROWSER_VERSION: 'latest'
#    POETRY_TAGS: $SMOKE_TESTS_TAG
#  resource_group: extended_tests_review_2
#
#win10-IE-latest-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-always
#  variables:
#    OS: Windows
#    OS_VERSION: 10
#    BROWSER: internet explorer
#    BROWSER_VERSION: 'latest'
#    POETRY_TAGS: $SMOKE_TESTS_TAG
#  resource_group: extended_tests_review_3
#
#win10-Edge-latest-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    OS: Windows
#    OS_VERSION: 10
#    BROWSER: MicrosoftEdge
#    BROWSER_VERSION: 'latest'
#    POETRY_TAGS: $SMOKE_TESTS_TAG
#  resource_group: extended_tests_review_4



#OSXCatalina-Safari-13.1-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-always
#  variables:
#    OS: macOS
#    OS_VERSION: '10.15'
#    BROWSER: safari
#    BROWSER_VERSION: '13.1'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: $SMOKE_TESTS_WITH_APPLE_PAY
#  resource_group: extended_tests_review_1
#
#OSXCatalina-Chrome-latest-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    OS: macOS
#    OS_VERSION: '10.15'
#    BROWSER: Chrome
#    BROWSER_VERSION: 'latest'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: $SMOKE_TESTS_TAG
#  resource_group: extended_tests_review_2
#
#OSXCatalina-Firefox-latest-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    OS: macOS
#    OS_VERSION: '10.15'
#    BROWSER: firefox
#    BROWSER_VERSION: 'latest'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: $SMOKE_TESTS_TAG
#  resource_group: extended_tests_review_3
#
#     EXTENDED
#
win10-Chrome-latest-extended-tests-1:
  extends:
    - .extended-tests-browserstack
    - .rules-extended-tests-always
  variables:
    OS: Windows
    OS_VERSION: 10
    BROWSER: chrome
    BROWSER_VERSION: 'latest'
    POETRY_TAGS: extended_tests_part_1
  resource_group: extended_tests_review_1

#win10-Firefox-latest-extended-tests-1:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-always
#  variables:
#    OS: Windows
#    OS_VERSION: 10
#    BROWSER: firefox
#    BROWSER_VERSION: 'latest'
#    POETRY_TAGS: extended_tests_part_1
#  resource_group: extended_tests_review_2
#
#win10-IE-latest-extended-tests-1:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-always
#  variables:
#    OS: Windows
#    OS_VERSION: 10
#    BROWSER: internet explorer
#    BROWSER_VERSION: 'latest'
#    POETRY_TAGS: extended_tests_part_1
#  resource_group: extended_tests_review_3
#
#win10-Edge-latest-extended-tests-1:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    OS: Windows
#    OS_VERSION: 10
#    BROWSER: MicrosoftEdge
#    BROWSER_VERSION: 'latest'
#    POETRY_TAGS: extended_tests_part_1
#  resource_group: extended_tests_review_4



OSXCatalina-Safari-13.1-extended-test-part-1:
  extends:
    - .extended-tests-browserstack
    - .rules-extended-tests-release
  variables:
    OS: macOS
    OS_VERSION: '10.15'
    BROWSER: safari
    BROWSER_VERSION: '13.1'
    AUTOMATION_TIMEOUT: 120
    POETRY_TAGS: extended_tests_part_1
  resource_group: extended_tests_release_1


#win10-Firefox-latest-extended-tests-2:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    OS: Windows
#    OS_VERSION: 10
#    BROWSER: firefox
#    BROWSER_VERSION: 'latest'
#    BROWSERSTACK_FIREFOX_DRIVER: '0.27.0'
#    BROWSERSTACK_SELENIUM_VERSION: '3.141.59'
#    POETRY_TAGS: extended_tests_part_2
#  resource_group: extended_tests_release_4
#
#win10-Firefox-latest-extended-tests-3:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    OS: Windows
#    OS_VERSION: 10
#    BROWSER: firefox
#    BROWSER_VERSION: 'latest'
#    BROWSERSTACK_FIREFOX_DRIVER: '0.27.0'
#    BROWSERSTACK_SELENIUM_VERSION: '3.141.59'
#    POETRY_TAGS: extended_tests_part_3
#  resource_group: extended_tests_release_1
#
#win10-IE-11.0-extended-test-part-2:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    OS: Windows
#    OS_VERSION: 10
#    BROWSER: internet explorer
#    BROWSER_VERSION: '11.285'
#    BROWSERSTACK_SELENIUM_VERSION: '3.141.59'
#    POETRY_TAGS: extended_tests_part_2
#  resource_group: extended_tests_release_2
#
#win10-IE-11.0-extended-test-part-3:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    OS: Windows
#    OS_VERSION: 10
#    BROWSER: internet explorer
#    BROWSER_VERSION: '11.285'
#    BROWSERSTACK_SELENIUM_VERSION: '3.141.59'
#    POETRY_TAGS: extended_tests_part_3
#  resource_group: extended_tests_release_3
#

#OSXMojave-Safari-12.1-extended-test-part-2:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    OS: OS X
#    OS_VERSION: Mojave
#    BROWSER: Safari
#    BROWSER_VERSION: '12.1'
#    ROWSERSTACK_SAFARI_DRIVER: '2.48'
#    BROWSERSTACK_SELENIUM_VERSION: '3.141.59'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: extended_tests_part_2,extended_tests_apple_pay
#  resource_group: extended_tests_release_1
#
#OSXMojave-Safari-12.1-extended-test-part-3:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    OS: OS X
#    OS_VERSION: Mojave
#    BROWSER: Safari
#    BROWSER_VERSION: '12.1'
#    BROWSERSTACK_SAFARI_DRIVER: '2.48'
#    BROWSERSTACK_SELENIUM_VERSION: '3.141.59'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: extended_tests_part_3
#  resource_group: extended_tests_release_2


#.iPhone11-14.0-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: iPhone 11
#    OS_VERSION: 14
#    BROWSER: Safari
#    REAL_MOBILE: 'true'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: $SMOKE_TESTS_WITH_APPLE_PAY
#  resource_group: extended_tests_release_2
#
#.iPhone8-11.0-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: iPhone 8
#    OS_VERSION: 11
#    BROWSER: Safari
#    REAL_MOBILE: 'true'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: $SMOKE_TESTS_WITH_APPLE_PAY
#  resource_group: extended_tests_release_3
#

#.iPhoneXS-12-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: iPhone XS
#    OS_VERSION: 12
#    BROWSER: Safari
#    REAL_MOBILE: 'true'
#    POETRY_TAGS: $SMOKE_TESTS_TAG
#    AUTOMATION_TIMEOUT: 120
#  resource_group: extended_tests_release_2
#
#.iPhone11-13-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: iPhone 11
#    OS_VERSION: 13
#    REAL_MOBILE: 'true'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: $SMOKE_TESTS_WITH_APPLE_PAY
#  resource_group: extended_tests_release_3
#
#.iPhone7-10.0-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: iPhone 7
#    OS_VERSION: 10
#    BROWSER: Safari
#    REAL_MOBILE: 'true'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: $SMOKE_TESTS_WITH_APPLE_PAY
#  resource_group: extended_tests_release_4
#
#SamsungGalaxyS8-7.0-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: Samsung Galaxy S8
#    OS_VERSION: '7.0'
#    REAL_MOBILE: 'true'
#    BROWSERSTACK_APPIUM_VERSION: '1.14.0'
#    POETRY_TAGS: $SMOKE_TESTS_TAG
#  resource_group: extended_tests_release_4
#
#SamsungGalaxyS10Plus-9.0-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: Samsung Galaxy S10 Plus
#    OS_VERSION: '9.0'
#    REAL_MOBILE: 'true'
#    BROWSERSTACK_APPIUM_VERSION: '1.18.0'
#    POETRY_TAGS: $SMOKE_TESTS_TAG
#  resource_group: extended_tests_release_1
#
#GooglePixel4-10.0-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: Google Pixel 4
#    OS_VERSION: '10.0'
#    REAL_MOBILE: 'true'
#    BROWSERSTACK_APPIUM_VERSION: '1.18.0'
#    POETRY_TAGS: $SMOKE_TESTS_TAG
#  resource_group: extended_tests_release_2
#
#.iPhoneXS-12-applePay-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: iPhone XS
#    OS_VERSION: 12
#    BROWSER: Safari
#    REAL_MOBILE: 'true'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: smoke_test_apple_pay
#  resource_group: extended_tests_release_3
#
#SamsungGalaxyS9-8.0-extended-test-part-1:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: Samsung Galaxy S9
#    OS_VERSION: '8.0'
#    REAL_MOBILE: 'true'
#    BROWSERSTACK_APPIUM_VERSION: '1.18.2'
#    POETRY_TAGS: extended_tests_part_1
#  resource_group: extended_tests_release_2
#
#SamsungGalaxyS9-8.0-extended-test-part-2:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: Samsung Galaxy S9
#    OS_VERSION: '8.0'
#    REAL_MOBILE: 'true'
#    BROWSERSTACK_APPIUM_VERSION: '1.18.2'
#    POETRY_TAGS: extended_tests_part_2
#  resource_group: extended_tests_release_3
#
#SamsungGalaxyS9-8.0-extended-test-part-3:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: Samsung Galaxy S9
#    OS_VERSION: '8.0'
#    REAL_MOBILE: 'true'
#    BROWSERSTACK_APPIUM_VERSION: '1.18.2'
#    POETRY_TAGS: extended_tests_part_3
#  resource_group: extended_tests_release_4
#
#
#SamsungGalaxyS20-10.0-smoke-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: Samsung Galaxy S20
#    OS_VERSION: '10.0'
#    REAL_MOBILE: 'true'
#    BROWSERSTACK_APPIUM_VERSION: '1.18.0'
#    POETRY_TAGS: $SMOKE_TESTS_TAG
#  resource_group: extended_tests_release_1
#
#SamsungGalaxyS6-5.0-browser-not-supported:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: Samsung Galaxy S6
#    OS_VERSION: '5.0'
#    REAL_MOBILE: 'true'
#    POETRY_TAGS: browser_info_not_supported
#  resource_group: extended_tests_release_2
#
#.iPhoneXR-12-full-test-part-1: # TODO https://securetrading.atlassian.net/browse/STJS-661
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: iPhone XR
#    OS_VERSION: 12
#    BROWSER: Safari
#    REAL_MOBILE: 'true'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: full_test_part_1
#  resource_group: extended_tests_release_1
#
#.iPhoneXR-12-full-test-part-2: # TODO https://securetrading.atlassian.net/browse/STJS-661
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: iPhone XR
#    OS_VERSION: 12
#    BROWSER: Safari
#    REAL_MOBILE: 'true'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: full_test_part_2
#  resource_group: extended_tests_release_2
#
#       VISUAL
#
#win10-IE-11.0-visual-tests:
#  extends:
#    - .visual-regression-tests
#    - .rules-extended-tests-release
#  variables:
#    OS: Windows
#    OS_VERSION: 10
#    BROWSER: IE
#    BROWSER_VERSION: '11.0'
#    BROWSERSTACK_SELENIUM_VERSION: '3.141.59'
#    POETRY_TAGS: visual_regression
#  resource_group: extended_tests_release_3
#
#win10-IE-11.0-visual-tests-styling:
#  extends:
#    - .visual-regression-tests
#    - .rules-extended-tests-release
#  variables:
#    OS: Windows
#    OS_VERSION: 10
#    BROWSER: IE
#    BROWSER_VERSION: '11.0'
#    BROWSERSTACK_SELENIUM_VERSION: '3.141.59'
#    POETRY_TAGS: visual_regression_styling
#  resource_group: extended_tests_release_4

#win10-Chrome-latest-visual-tests:
#  extends:
#    - .visual-regression-tests
#    - .rules-extended-tests-always
#  variables:
#    OS: Windows
#    OS_VERSION: 10
#    BROWSER: Chrome
#    BROWSER_VERSION: 'latest'
#    POETRY_TAGS: visual_regression
#  resource_group: extended_tests_review_1
#
#win10-Chrome-latest-visual-tests-styling:
#  extends:
#    - .visual-regression-tests
#    - .rules-extended-tests-always
#  variables:
#    OS: Windows
#    OS_VERSION: 10
#    BROWSER: Chrome
#    BROWSER_VERSION: 'latest'
#    POETRY_TAGS: visual_regression_styling
#  resource_group: extended_tests_review_2
#
#
#iPhoneXS-12-visual-tests-styling:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: iPhone XS
#    OS_VERSION: 12
#    BROWSER: Safari
#    REAL_MOBILE: 'true'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: visual_regression_styling_safari
#  resource_group: extended_tests_release_3
#
#OSXMojave-Safari-12.1-visual-tests-styling:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    OS: OS X
#    OS_VERSION: Mojave
#    BROWSER: Safari
#    BROWSER_VERSION: '12.1'
#    ROWSERSTACK_SAFARI_DRIVER: '2.48'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: visual_regression_styling_safari
#  resource_group: extended_tests_release_4


#SamsungGalaxyS20-10.0-visual-tests:
#  extends:
#    - .visual-regression-tests
#    - .rules-extended-tests-always
#  variables:
#    DEVICE: Samsung Galaxy S20
#    OS_VERSION: '10.0'
#    REAL_MOBILE: 'true'
#    BROWSERSTACK_APPIUM_VERSION: '1.18.2'
#    POETRY_TAGS: visual_regression
#  resource_group: extended_tests_release_2
#
#iPhoneXS-12-visual-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    DEVICE: iPhone XS
#    OS_VERSION: 12
#    BROWSER: Safari
#    REAL_MOBILE: 'true'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: visual_regression_safari
#  resource_group: extended_tests_release_3
#
#OSXMojave-Safari-12.1-visual-tests:
#  extends:
#    - .extended-tests-browserstack
#    - .rules-extended-tests-release
#  variables:
#    OS: OS X
#    OS_VERSION: Mojave
#    BROWSER: Safari
#    BROWSER_VERSION: '12.1'
#    ROWSERSTACK_SAFARI_DRIVER: '2.48'
#    BROWSERSTACK_SELENIUM_VERSION: '3.141.59'
#    AUTOMATION_TIMEOUT: 120
#    POETRY_TAGS: visual_regression_safari
#  resource_group: extended_tests_release_4
#
#SamsungGalaxyS20-10.0-visual-tests-styling:
#  extends:
#    - .visual-regression-tests
#    - .rules-extended-tests-always
#  variables:
#    DEVICE: Samsung Galaxy S20
#    OS_VERSION: '10.0'
#    REAL_MOBILE: 'true'
#    BROWSERSTACK_APPIUM_VERSION: '1.18.0'
#    POETRY_TAGS: visual_regression_styling
#  resource_group: extended_tests_release_1
#
