.component-tests:
  image: ${IMAGE_JS_PAYMENTS_TESTS}
  variables:
    BEHAVE_LOGGING_LEVEL: INFO
    FF_NETWORK_PER_BUILD: 'true' # https://docs.gitlab.com/runner/configuration/feature-flags.html
    FEATURE_FILES_DIR: 'features'

.component-tests-services:
  services:
    - name: "${IMAGE_JS_PAYMENTS_APP_HTML_TEST}"
      alias: library.securetrading.net
    - name: "${IMAGE_JS_PAYMENTS_APP_HTML_TEST}"
      alias: merchant.securetrading.net
    - name: "${IMAGE_JS_PAYMENTS_WIREMOCK}"
      alias: webservices.securetrading.net
      command: ["--https-port", "8443", "--https-keystore", "/home/wiremock/keystore"]
    - name: "${IMAGE_JS_PAYMENTS_WIREMOCK}"
      alias: thirdparty.example.com
      command: ["--https-port", "8443", "--https-keystore", "/home/wiremock/keystore"]

card-payments-headless-component-tests:
  extends:
    - .fast-tests
    - .component-tests
    - .component-tests-services
    - .parallel-tests
  variables:
    FEATURE_FILES_NAMES_CONTAINS: 'mock_'
  parallel: 20

visa-checkout-headless-component-tests:
  extends:
    - .fast-tests
    - .component-tests
    - .component-tests-services
    - .sequentially-tests
  variables:
    FEATURE_FILE_NAME: 'visa_checkout_tests.feature'

.apple-test-browserstack-component-test:
  extends:
    - .fast-tests
    - .component-tests
    - .component-tests-services
    - .browserstack
  variables:
    OS: "OS X"
    OS_VERSION: Mojave
    BROWSER: Safari
    BROWSER_VERSION: '12.1'

apple-test-part1-browserstack-component-test:
  extends: .apple-test-browserstack-component-test
  variables:
    POETRY_TAGS: apple_test_part1

apple-test-part2-browserstack-component-test:
  extends: .apple-test-browserstack-component-test
  variables:
    POETRY_TAGS: apple_test_part2

.e2e-tests:
  image: ${IMAGE_JS_PAYMENTS_TESTS}
  variables:
    BEHAVE_LOGGING_LEVEL: INFO
    FF_NETWORK_PER_BUILD: 'true' # https://docs.gitlab.com/runner/configuration/feature-flags.html
    FEATURE_FILES_DIR: 'features/e2e_tests'
  before_script:
    - test -n "${EMAIL_LOGIN:-}"
    - test -n "${EMAIL_PASSWORD:-}"
    - test -n "${JWT_ISS_KEY:-}"
    - test -n "${JWT_SECRET_KEY_BASE64:-}"
    - JWT_SECRET_KEY=$(echo ${JWT_SECRET_KEY_BASE64} | base64 -d)
    - export JWT_SECRET_KEY
    - test -n "${JWT_SECRET_KEY:-}"

.e2e-tests-services:
  services:
    - name: "${IMAGE_JS_PAYMENTS_APP_HTML_DEV}"
      alias: library.securetrading.net
    - name: "${IMAGE_JS_PAYMENTS_APP_HTML_DEV}"
      alias: merchant.securetrading.net

#e2e-tests: # TODO INFRA-228
#  extends:
#    - .fast-tests
#    - .e2e-tests
#    - .e2e-tests-services
#    - .parallel-tests
#  parallel: 9
