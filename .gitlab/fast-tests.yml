.image-test:
  image: ${IMAGE_JS_PAYMENTS_TESTS}

.services-test:
  services:
    - name: "${IMAGE_JS_PAYMENTS_APP_HTML_TEST}"
      alias: library.securetrading.net
    - name: "${IMAGE_JS_PAYMENTS_APP_HTML_TEST}"
      alias: merchant.securetrading.net
    - name: "${IMAGE_JS_PAYMENTS_WIREMOCK}"
      alias: webservices.securetrading.net
      command: ["--https-port", "8443", "--https-keystore", "/home/wiremock/keystore"]
    - name: "${IMAGE_JS_PAYMENTS_WIREMOCK}"
      alias: thirdparty.example.com
      command: ["--https-port", "8443", "--https-keystore", "/home/wiremock/keystore"]

card-payments-headless-component-tests:
  extends:
    - .image-test
    - .fast-tests
    - .services-test
    - .parallel-tests
  variables:
    FEATURE_FILES_NAMES_CONTAINS: 'mock_'
  parallel: 22

visa-checkout-headless-component-tests:
  extends:
    - .image-test
    - .fast-tests
    - .component-tests
    - .services-test
    - .sequentially-tests
  variables:
    FEATURE_FILE_NAME: 'visa_checkout_tests.feature'

.services-dev:
  services:
    - name: "${IMAGE_JS_PAYMENTS_APP_HTML_DEV}"
      alias: library.securetrading.net
    - name: "${IMAGE_JS_PAYMENTS_APP_HTML_DEV}"
      alias: merchant.securetrading.net

e2e-tests:
  extends:
    - .image-test
    - .fast-tests
    - .e2e-tests
    - .services-dev
    - .parallel-tests
  parallel: 14

zap-baseline-scan-library-securetrading-net:
  services:
    - name: "${IMAGE_JS_PAYMENTS_APP_HTML_DEV}"
      alias: library.securetrading.net
  extends:
    - .zap-baseline-scan
  variables:
    URL_TO_SCAN: 'https://library.securetrading.net'
    ZAP_CONFIG_PATH: "baseline-scan.conf"

zap-baseline-scan-merchant-securetrading-net:
  services:
    - name: "${IMAGE_JS_PAYMENTS_APP_HTML_DEV}"
      alias: merchant.securetrading.net
  extends:
    - .zap-baseline-scan
  variables:
    URL_TO_SCAN: 'https://merchant.securetrading.net'
    ZAP_CONFIG_PATH: "baseline-scan.conf"
